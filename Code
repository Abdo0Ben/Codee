import os
import telebot
import requests
import logging
import json
from datetime import datetime, timedelta
from telebot import types

# Ø¥Ø¹Ø¯Ø§Ø¯ ØªÙƒÙˆÙŠÙ† logging
logging.basicConfig(level=logging.ERROR, format='%(asctime)s - %(levelname)s - %(message)s')

# ØªÙˆÙƒÙ† Ø¨ÙˆØª
bot = telebot.TeleBot('5716655872:AAFln4t399cVyw81rMPygheO85vipKmYW9c')

# Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
tokens = {}  # {user_id: token}
start_times = {}  # {user_id: start_time}
allowed_users = {}  # {user_id: expiration_date}

# ØªÙƒÙˆÙŠÙ†Ø§Øª Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ
PROXY = {
    'http': '9bkedt93m0c1vm4-country-dz:76c53yagdarivz2@172.65.64.100:6060',
    'https': '9bkedt93m0c1vm4-country-dz:76c53yagdarivz2@172.65.64.100:6060'
}

# Admin ID
ADMIN_ID = '5451876878'

# Load users from JSON file
def load_users():
    global allowed_users
    if os.path.exists('users.json'):
        with open('users.json', 'r') as file:
            allowed_users = json.load(file)

# Save users to JSON file
def save_users():
    with open('users.json', 'w') as file:
        json.dump(allowed_users, file)

# Load users initially
load_users()

def save_token(user_id, token):
    tokens[str(user_id)] = token
    print(f"ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙˆÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… {user_id}")

def delete_token(user_id):
    if str(user_id) in tokens:
        del tokens[str(user_id)]
        print(f"ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙˆÙƒÙ† Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… {user_id}")

def get_user_token(user_id):
    return tokens.get(str(user_id))

def save_start_time(user_id, start_time):
    start_times[str(user_id)] = start_time

def can_use_start(user_id):
    last_start_time = start_times.get(str(user_id))
    if last_start_time:
        last_start_time = datetime.strptime(last_start_time, '%Y-%m-%d %H:%M:%S')
        time_diff = datetime.now() - last_start_time
        if time_diff < timedelta(minutes=0):
            return False, timedelta(minutes=0) - time_diff
    return True, None

def is_user_allowed(user_id):
    user_id_str = str(user_id)
    expiration_date_str = allowed_users.get(user_id_str)

    if expiration_date_str:
        try:
            expiration_date = datetime.strptime(expiration_date_str, '%Y-%m-%d %H:%M:%S')
            if datetime.now() < expiration_date:
                return True, expiration_date
            else:
                delete_token(user_id)
                del allowed_users[user_id_str]
                save_users()
                bot.send_message(user_id, "Ù„Ù„Ø£Ø³ÙğŸ¥€ğŸ’”Ù„Ù‚Ø¯ Ø§Ù†ØªÙ‡Ø§ ÙˆÙ‚Øª Ø£Ø´ØªØ±Ø§ÙƒÙƒ ÙÙŠ Ø§Ù„Ø¨ÙˆØª Ø§Ø°Ø§ ÙƒÙ†Øª ØªØ±ÙŠØ¯ Ø§Ù„Ø£Ø´ØªØ±Ø§Ùƒ Ù…Ø±Ø© Ø§Ø®Ø±Ø© ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø·ÙˆØ± @G_GVT ğŸ“±ğŸ")
                return False, None
        except ValueError as e:
            logging.error(f"ØªÙ†Ø³ÙŠÙ‚ ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­: {expiration_date_str}")
            return False, None
    return False, None

@bot.message_handler(commands=['admin'])
def handle_admin(message):
    if str(message.from_user.id) == ADMIN_ID:
        markup = types.InlineKeyboardMarkup()
        add_button = types.InlineKeyboardButton('Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… â•', callback_data='add_user')
        remove_button = types.InlineKeyboardButton('Ø¥Ø²Ø§Ù„Ø© Ù…Ø³ØªØ®Ø¯Ù… â–', callback_data='remove_user')
        markup.add(add_button, remove_button)
        bot.send_message(message.chat.id, "Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ğŸ‘®ğŸ»â€â™‚ï¸", reply_markup=markup)
    else:
        bot.send_message(message.chat.id, "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø±.")

@bot.callback_query_handler(func=lambda call: call.data in ['add_user', 'remove_user'])
def handle_admin_action(call):
    if call.data == 'add_user':
        msg = bot.send_message(call.message.chat.id, "ğŸš€ Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØªÙ‡:")
        bot.register_next_step_handler(msg, process_add_user)
    elif call.data == 'remove_user':
        msg = bot.send_message(call.message.chat.id, "ğŸš€ Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø¥Ø²Ø§Ù„ØªÙ‡:")
        bot.register_next_step_handler(msg, process_remove_user)

def process_add_user(message):
    try:
        user_id = message.text
        msg = bot.send_message(message.chat.id, "âŒ›ï¸ Ø£Ø¯Ø®Ù„ Ù…Ø¯Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…):")
        bot.register_next_step_handler(msg, lambda m: add_user_with_duration(m, user_id))
    except Exception as e:
        bot.send_message(message.chat.id, "Ø­Ø¯Ø« Ø®Ø·Ø£. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

def add_user_with_duration(message, user_id):
    try:
        days = int(message.text)
        expiration_date = (datetime.now() + timedelta(days=days)).strftime('%Y-%m-%d %H:%M:%S')
        allowed_users[user_id] = expiration_date
        save_users()
        bot.send_message(message.chat.id, f"ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… {user_id} Ø¨Ù†Ø¬Ø§Ø­. ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: {expiration_date}")
    except ValueError:
        bot.send_message(message.chat.id, "Ø§Ù„Ù…Ø¯Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

def process_remove_user(message):
    try:
        user_id = message.text
        if user_id in allowed_users:
            del allowed_users[user_id]
            delete_token(user_id)
            save_users()
            bot.send_message(message.chat.id, f"ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… {user_id} Ø¨Ù†Ø¬Ø§Ø­.")
        else:
            bot.send_message(message.chat.id, "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.")
    except Exception as e:
        bot.send_message(message.chat.id, "Ø­Ø¯Ø« Ø®Ø·Ø£. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")

@bot.message_handler(content_types=['text'])
def handle_message(message):
    user_id = message.from_user.id
    allowed, expiration_date = is_user_allowed(user_id)

    if not allowed:
        bot.send_message(message.chat.id, "Ø£Ù†Øª ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ù„Ùƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØª Ù…Ù† Ù‚Ø¨Ù„ @G_GVT Ø§Ù„Ù…Ø·ÙˆØ±ğŸ¥±ğŸ•µğŸ»â€â™‚ï¸.")
        return

    if message.text.startswith('/start'):
        token = get_user_token(user_id)
        if token:
            can_start, time_remaining = can_use_start(user_id)
            if can_start:
                save_start_time(user_id, datetime.now().strftime('%Y-%m-%d %H:%M:%S'))
                apply_bonus(token, message)
            else:
                minutes = time_remaining.seconds // 60
                seconds = time_remaining.seconds % 60
                bot.send_message(message.chat.id, f'ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± {minutes} Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ {seconds} Ø«Ø§Ù†ÙŠØ© Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ù…Ø± /start Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.')
        else:
            first_name = message.from_user.first_name
            last_name = message.from_user.last_name or ""
            username = message.from_user.username or ""

            markup = types.InlineKeyboardMarkup()
            reset_button = types.InlineKeyboardButton('/reset', callback_data='reset')
            markup.add(reset_button)

            if expiration_date:
                time_remaining = expiration_date - datetime.now()
                days_remaining = time_remaining.days
                hours_remaining = time_remaining.seconds // 3600
                minutes_remaining = (time_remaining.seconds % 3600) // 60
                time_info = (f"ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØªÙƒ: {expiration_date.strftime('%Y-%m-%d %H:%M:%S')}\n"
                             f"Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: {days_remaining} ÙŠÙˆÙ… Ùˆ {hours_remaining} Ø³Ø§Ø¹Ø© Ùˆ {minutes_remaining} Ø¯Ù‚ÙŠÙ‚Ø©.")
            else:
                time_info = "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©."

            greeting = f"Ù…Ø±Ø­Ø¨Ø§ ğŸ‘‹ğŸ»       @{username} {time_info}              Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ ÙŠÙˆØ² ÙÙ‚Ø·"
            bot.send_message(message.chat.id, greeting, reply_markup=markup)
            bot.register_next_step_handler(message, get_phone_number)
    elif message.text.startswith('/reset'):
        reset_bot(message)
    elif message.text.startswith('/use_token'):
        token = get_user_token(user_id)
        if token:
            apply_bonus(token, message)
        else:
            bot.send_message(message.chat.id, 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ù…Ø®Ø²Ù† Ø£Ùˆ Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± ØµØ§Ù„Ø­.')
    elif message.text.startswith('/balance'):
        send_balance_info(message)
    elif message.text.startswith('/status'):
        if expiration_date:
            time_remaining = expiration_date - datetime.now()
            days_remaining = time_remaining.days
            hours_remaining = time_remaining.seconds // 3600
            minutes_remaining = (time_remaining.seconds % 3600) // 60
            bot.send_message(
                message.chat.id,
                f"ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØªÙƒ: {expiration_date.strftime('%Y-%m-%d %H:%M:%S')}\n"
                f"Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: {days_remaining} ÙŠÙˆÙ… Ùˆ {hours_remaining} Ø³Ø§Ø¹Ø© Ùˆ {minutes_remaining} Ø¯Ù‚ÙŠÙ‚Ø©."
            )
        else:
            bot.send_message(message.chat.id, "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØªÙƒ.")
    else:
        bot.send_message(message.chat.id, 'Ø¹ÙÙˆØ§ğŸ˜… Ø§Ø°Ø§ ÙƒÙ†Øª ØªØ±ÙŠØ¯ Ø§Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ Ø§ØµØºØ· Ø¹Ù„Ù‰ /start. Ø§Ù…Ø§ Ø§Ø°Ø§ ÙƒÙ†Øª ØªØ±ÙŠØ¯ Ø§Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¨ÙˆØª ÙˆØ­Ø°Ù Ø§Ø§Ø±Ù‚Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ /reset')

def reset_bot(message):
    delete_token(message.from_user.id)
    bot.send_message(message.chat.id, 'ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¨ÙˆØª Ø¨Ù†Ø¬Ø§Ø­ Ø£Ø¶ØºØ· Ø¹Ù„Ù‰. /start. ÙˆØ¨Ø¹Ø¯Ù‡Ø§ Ù‚Ù… Ø¨Ø£Ø±Ø³Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ğŸ“±.')

def get_phone_number(message):
    num = message.text
    headers = {
        'Content-Type': 'application/x-www-form-urlencoded',
        'Host': 'ibiza.ooredoo.dz',
        'Connection': 'Keep-Alive',
        'User-Agent': 'okhttp/4.9.3',
    }

    data = {
        'client_id': 'ibiza-app',
        'grant_type': 'password',
        'mobile-number': num,
        'language': 'AR',
    }

    try:
        response = requests.post('https://ibiza.ooredoo.dz/auth/realms/ibiza/protocol/openid-connect/token', headers=headers, data=data, proxies=PROXY)
        if 'ROOGY' in response.text:
            bot.send_message(message.chat.id,'ØªÙ… Ø£Ø±Ø³Ø§Ù„ ğŸ’¬Ø±Ù…Ø² Ø§Ù„Ù‰ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ ğŸ“±Ø¨Ù†Ø¬Ø§Ø­âœ… Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ø¯Ù†Ø§Ù‡ğŸ‘‡ğŸ»')
            bot.register_next_step_handler(message, get_otp, num)
        else:
            bot.send_message(message.chat.id, 'âŒÙˆÙ‚Ø¹ Ø®Ø·Ø§Ø¡ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§ .')
    except Exception as e:
        logging.error(f"Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© OTP: {e}")
        bot.send_message(message.chat.id, 'ÙˆÙ‚Ø¹ Ø®Ø·Ø§Ø¡ âŒØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ù…Ø² Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ù† Ø¬Ø¯ÙŠØ¯ ğŸ”„')

def get_otp(message, num):
    otp = message.text
    headers = {
        'Content-Type': 'application/x-www-form-urlencoded',
        'Host': 'ibiza.ooredoo.dz',
        'Connection': 'Keep-Alive',
        'User-Agent': 'okhttp/4.9.3',
    }

    data = {
        'client_id': 'ibiza-app',
        'otp': otp,
        'grant_type': 'password',
        'mobile-number': num,
        'language': 'AR',
    }

    try:
        response = requests.post('https://ibiza.ooredoo.dz/auth/realms/ibiza/protocol/openid-connect/token', headers=headers, data=data, proxies=PROXY)
        access_token = response.json().get('access_token')
        if access_token:
            save_token(message.from_user.id, access_token)
            bot.send_message(
                message.chat.id,
                'ØªÙ… Ø­ÙØ¸ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ§Ù„ÙŠØ©:\n'
                '/start - Ù„Ø¨Ø¯Ø¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØª\n'
                '/reset - Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ØªÙˆÙƒÙ†\n'
                '/balance - Ù„Ù…Ø¹Ø±ÙØ© Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ\n'
                '/status - Ù„Ù…Ø¹Ø±ÙØ© ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØªÙƒ ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ'
            )
        else:
            bot.send_message(message.chat.id, 'Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø°ÙŠ Ø£Ø¯Ø®Ù„ØªÙ‡ ØºÙŠØ± ØµØ­ÙŠØ­ âŒ')
    except Exception as e:
        logging.error(f"Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† OTP: {e}")
        bot.send_message(message.chat.id, 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† OTP.')

def apply_bonus(access_token, message):
    url = 'https://ibiza.ooredoo.dz/api/v1/mobile-bff/users/mgm/info/apply'
    headers = {
        'Authorization': f'Bearer {access_token}',
        'language': 'AR',
        'request-id': 'ef69f4c6-2ead-4b93-95df-106ef37feefd',
        'flavour-type': 'gms',
        'Content-Type': 'application/json'
    }
    payload = {
        "mgmValue": "ABC"  
    }

    counter = 0
    while counter < 12:
        response = requests.post(url, headers=headers, json=payload, proxies=PROXY)

        if 'EU1002' in response.text:
            bonus = get_bonus_details(access_token)
            bot.send_message(message.chat.id, f'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù†ØªØ±Ù†Øª Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¨Ø±ÙˆÙƒ ğŸ‰ğŸ’¯\nØ§Ù„Ø¨ÙˆÙ†Øµ Ø§Ù„Ø­Ø§Ù„ÙŠ: {bonus}')
            balance = get_internet_balance(access_token)
            bot.send_message(message.chat.id, f"Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„Ø­Ø§Ù„ÙŠ:\n{balance}")
            return True
        else:
            bot.send_message(message.chat.id, 'Ø´Ø±ÙŠØ­ØªÙƒ Ù…Ø¹Ø¨Ø¦Ø© Ø¨Ù„ÙƒØ§Ù…Ù„ Ù„Ø¯ÙŠÙƒ 6G Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§ ğŸ‘ŒğŸ»ğŸ”„.')
            return False

        counter += 1
        time.sleep(1)

def get_bonus_details(access_token):
    return "GB"

def get_internet_balance(access_token):
    url = 'https://ibiza.ooredoo.dz/api/v1/mobile-bff/users/balance'
    headers = {
        'Authorization': f'Bearer {access_token}',
        'Content-Type': 'application/json',
        'language': 'AR'
    }
    try:
        response = requests.get(url, headers=headers, proxies=PROXY)
        if response.status_code == 200:
            data = response.json()
            accounts = data.get('accounts', [])
            if accounts:
                balance_info = []
                for account in accounts:
                    label = account.get('label', 'ØºÙŠØ± Ù…ØªÙˆÙØ±')
                    value = account.get('value', 'ØºÙŠØ± Ù…ØªÙˆÙØ±')
                    balance_info.append(f"{label}: {value}")
                return "\n".join(balance_info)
            else:
                return 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø±ØµÙŠØ¯'
        else:
            error_message = f'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±ØµÙŠØ¯. Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: {response.status_code}, Ù†Øµ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: {response.text}'
            logging.error(error_message)
            return 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±ØµÙŠØ¯'
    except Exception as e:
        logging.error(f"Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±ØµÙŠØ¯: {e}")
        return 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±ØµÙŠØ¯'

def send_balance_info(message):
    access_token = get_user_token(message.from_user.id)
    if access_token:
        balance = get_internet_balance(access_token)
        bot.send_message(message.chat.id, f"Ø±ØµÙŠØ¯ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„Ø­Ø§Ù„ÙŠ:\n{balance}")
    else:
        bot.send_message(message.chat.id, 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙˆÙƒÙ† Ù…Ø®Ø²Ù† Ø£Ùˆ Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± ØµØ§Ù„Ø­.')

@bot.message_handler(func=lambda message: not is_user_allowed(message.from_user.id), content_types=['text'])
def handle_unauthorized(message):
    bot.send_message(message.chat.id, "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø§Ù„Ø£Ø°Ù† ÙÙŠ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª Ø±Ø§Ø³Ù„ Ø§Ù„Ù…Ø·ÙˆØ±ğŸ•µğŸ»â€â™‚ï¸@G_GVT ğŸ¥±")

bot.polling(none_stop=True)
